// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
// # You can use CoffeeScript in this file: http://coffeescript.org/


var repl;
var TOKEN;
var lang = "ruby";
var startToken = function(lang){
  $(".out").empty();
  $.ajax({
    url: '/gen_token',
    success: function(data){
      TOKEN = {time_created: data.time_created, msg_mac: data.msg_mac};
      connectRepl(TOKEN, lang);
    }
  });
}

var connectRepl = function(token, lang){
  repl = new ReplitClient('api.repl.it', '80', lang, TOKEN);
  repl.connect().then(
    function() {
      document.querySelector('.status').innerHTML = 'connected';
      start(repl);
    },
    function() {
      document.querySelector('.status').innerHTML = 'failed';
    }
  );


}


function start(repl) {

  $( "#runcode" ).on('click', function() {
    $(".out").empty();
    // document.querySelector('.out').innerHTML = "";
    // document.querySelector('.out').innerHTML += spiner;
    text = firepad.getText();
    repl.evaluateOnce(
      text,
      {
        stdout: function(str) {
          document.querySelector('.out').innerHTML += str;
        }
      }
    ).then(
      function(result) {
        // document.querySelector('.result').innerHTML += (result.error || result.data) + '\n';

      },
      function(err) {
        // console.error(err);
      }
    );
  });
}

$(document).on('ready', function(e){
  startToken("ruby");
  // jsFunction returns the language to run the code in :)

});
// $(document).on('change', function(){
//   startToken(jsFunction());
//   createFirepad(jsFunction());
//
// })
$("#java").on("click", function(){

})
$("#ruby").on("click", function(){
  myselect = "ruby"
})
